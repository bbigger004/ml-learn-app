<!DOCTYPE html>
<!-- HTMLæ–‡æ¡£å£°æ˜ï¼Œå‘Šè¯‰æµè§ˆå™¨è¿™æ˜¯HTML5æ–‡æ¡£ -->
<html lang="zh-CN">
  <head>
    <!-- å¤´éƒ¨ä¿¡æ¯ï¼ŒåŒ…å«é¡µé¢å…ƒæ•°æ® -->
    <meta charset="UTF-8" />  <!-- è®¾ç½®å­—ç¬¦ç¼–ç ä¸ºUTF-8ï¼Œæ”¯æŒä¸­æ–‡æ˜¾ç¤º -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />  <!-- è®¾ç½®è§†å£ï¼Œç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ­£å¸¸æ˜¾ç¤º -->
    <title>æ•æ„Ÿäººç¾¤åŠ¨æ€ä¿ç”µ - æŠ•è¯‰é£é™©é¢„æµ‹</title>  <!-- é¡µé¢æ ‡é¢˜ -->
    <!-- å¼•å…¥TensorFlow.jsåº“ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæœºå™¨å­¦ä¹  -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
    <!-- å¼•å…¥TensorFlow.jså¯è§†åŒ–å·¥å…·åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.5.1"></script>
    <!-- CSSæ ·å¼å®šä¹‰ -->
    <style>
      /* ç½‘é¡µæ•´ä½“æ ·å¼ */
      body {
        font-family: 'Microsoft YaHei', Arial, sans-serif;  /* è®¾ç½®å­—ä½“ï¼Œä¼˜å…ˆä½¿ç”¨å¾®è½¯é›…é»‘ */
        max-width: 1200px;  /* æœ€å¤§å®½åº¦é™åˆ¶ */
        margin: 0 auto;  /* æ°´å¹³å±…ä¸­ */
        padding: 20px;  /* å†…è¾¹è· */
        background-color: #f5f5f5;  /* èƒŒæ™¯é¢œè‰² */
      }
      /* ä¸»å®¹å™¨æ ·å¼ */
      .container {
        background: white;  /* èƒŒæ™¯ä¸ºç™½è‰² */
        padding: 30px;  /* å†…è¾¹è· */
        border-radius: 10px;  /* åœ†è§’è¾¹æ¡† */
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);  /* è½»å¾®é˜´å½±æ•ˆæœ */
      }
      /* é¡µé¢å¤´éƒ¨æ ·å¼ */
      .header {
        text-align: center;  /* æ–‡æœ¬å±…ä¸­ */
        margin-bottom: 30px;  /* åº•éƒ¨å¤–è¾¹è· */
        color: #2c3e50;  /* æ–‡å­—é¢œè‰² */
      }
      /* ç½‘æ ¼å¸ƒå±€æ ·å¼ */
      .grid {
        display: grid;  /* ä½¿ç”¨CSS Gridå¸ƒå±€ */
        grid-template-columns: 1fr 1fr;  /* ä¸¤åˆ—ç­‰å®½å¸ƒå±€ */
        gap: 20px;  /* ç½‘æ ¼é—´è· */
        margin-bottom: 20px;  /* åº•éƒ¨å¤–è¾¹è· */
      }
      /* å¡ç‰‡åŸºç¡€æ ·å¼ */
      .card {
        background: #f8f9fa;  /* å¡ç‰‡èƒŒæ™¯è‰² */
        padding: 20px;  /* å†…è¾¹è· */
        border-radius: 8px;  /* åœ†è§’è¾¹æ¡† */
        border-left: 4px solid #3498db;  /* å·¦ä¾§è“è‰²è¾¹æ¡† */
      }
      /* é«˜é£é™©å¡ç‰‡æ ·å¼ */
      .card.high-risk {
        border-left-color: #e74c3c;  /* é«˜é£é™©ä½¿ç”¨çº¢è‰²è¾¹æ¡† */
        background: #ffeaea;  /* é«˜é£é™©ä½¿ç”¨æµ…çº¢è‰²èƒŒæ™¯ */
      }
      /* ä¸­é£é™©å¡ç‰‡æ ·å¼ */
      .card.medium-risk {
        border-left-color: #f39c12;  /* ä¸­é£é™©ä½¿ç”¨æ©™è‰²è¾¹æ¡† */
        background: #fff3cd;  /* ä¸­é£é™©ä½¿ç”¨æµ…é»„è‰²èƒŒæ™¯ */
      }
      /* æŒ‰é’®åŸºç¡€æ ·å¼ */
      button {
        background: #3498db;  /* è“è‰²èƒŒæ™¯ */
        color: white;  /* ç™½è‰²æ–‡å­— */
        border: none;  /* æ— è¾¹æ¡† */
        padding: 12px 24px;  /* å†…è¾¹è· */
        border-radius: 5px;  /* åœ†è§’è¾¹æ¡† */
        cursor: pointer;  /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹å‹ */
        font-size: 16px;  /* å­—ä½“å¤§å° */
        margin: 10px 5px;  /* å¤–è¾¹è· */
      }
      /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
      button:hover {
        background: #2980b9;  /* æ‚¬åœæ—¶èƒŒæ™¯è‰²å˜æ·± */
      }
      /* ç¦ç”¨æŒ‰é’®æ ·å¼ */
      button:disabled {
        background: #bdc3c7;  /* ç¦ç”¨æ—¶èƒŒæ™¯è‰²ä¸ºç°è‰² */
        cursor: not-allowed;  /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºç¦æ­¢å›¾æ ‡ */
      }
      /* é£é™©æŒ‡ç¤ºå™¨æ ·å¼ */
      .risk-indicator {
        display: inline-block;  /* è¡Œå†…å—å…ƒç´  */
        padding: 4px 12px;  /* å†…è¾¹è· */
        border-radius: 20px;  /* åœ†å½¢æŒ‡ç¤ºå™¨ */
        color: white;  /* ç™½è‰²æ–‡å­— */
        font-weight: bold;  /* åŠ ç²—æ–‡å­— */
        margin-left: 10px;  /* å·¦ä¾§å¤–è¾¹è· */
      }
      /* ä½é£é™©æŒ‡ç¤ºå™¨ */
      .risk-low {
        background: #27ae60;  /* ç»¿è‰²èƒŒæ™¯ */
      }
      /* ä¸­é£é™©æŒ‡ç¤ºå™¨ */
      .risk-medium {
        background: #f39c12;  /* æ©™è‰²èƒŒæ™¯ */
      }
      /* é«˜é£é™©æŒ‡ç¤ºå™¨ */
      .risk-high {
        background: #e74c3c;  /* çº¢è‰²èƒŒæ™¯ */
      }
      /* ç‰¹å¾é‡è¦æ€§å®¹å™¨ */
      .feature-importance {
        margin-top: 20px;  /* é¡¶éƒ¨å¤–è¾¹è· */
      }
      /* ç‰¹å¾æ¡æ ·å¼ */
      .feature-bar {
        display: flex;  /* ä½¿ç”¨å¼¹æ€§å¸ƒå±€ */
        align-items: center;  /* å‚ç›´å±…ä¸­å¯¹é½ */
        margin: 8px 0;  /* ä¸Šä¸‹å¤–è¾¹è· */
      }
      /* ç‰¹å¾åç§°æ ·å¼ */
      .feature-name {
        width: 200px;  /* å›ºå®šå®½åº¦ */
        font-weight: bold;  /* åŠ ç²—æ–‡å­— */
      }
      /* ç‰¹å¾å€¼å®¹å™¨ */
      .feature-value {
        flex-grow: 1;  /* è‡ªåŠ¨å¢é•¿ï¼Œå æ®å‰©ä½™ç©ºé—´ */
        height: 20px;  /* é«˜åº¦ */
        background: #ecf0f1;  /* èƒŒæ™¯è‰² */
        border-radius: 10px;  /* åœ†è§’ */
        overflow: hidden;  /* éšè—æº¢å‡ºå†…å®¹ */
      }
      /* ç‰¹å¾å€¼å¡«å……æ¡ */
      .feature-fill {
        height: 100%;  /* å¡«å……æ•´ä¸ªå®¹å™¨é«˜åº¦ */
        background: linear-gradient(90deg, #3498db, #2ecc71);  /* ä»è“åˆ°ç»¿çš„æ¸å˜ */
        transition: width 0.5s;  /* å®½åº¦å˜åŒ–è¿‡æ¸¡åŠ¨ç”» */
      }
    </style>
  </head>
  <body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
      <!-- é¡µé¢å¤´éƒ¨ -->
      <div class="header">
        <h1>ğŸ  æ•æ„Ÿäººç¾¤åŠ¨æ€ä¿ç”µ - æŠ•è¯‰é£é™©é¢„æµ‹</h1>  <!-- ä¸»æ ‡é¢˜ -->
        <p>åŸºäºLightGBMæ€æƒ³çš„TensorFlow.jsç¥ç»ç½‘ç»œé¢„æµ‹æ¨¡å‹</p>  <!-- å‰¯æ ‡é¢˜ -->
      </div>

      <!-- ç½‘æ ¼å¸ƒå±€åŒºåŸŸ -->
      <div class="grid">
        <!-- æ¨¡å‹è®­ç»ƒçŠ¶æ€å¡ç‰‡ -->
        <div class="card">
          <h3>ğŸ“Š æ¨¡å‹è®­ç»ƒçŠ¶æ€</h3>  <!-- å¡ç‰‡æ ‡é¢˜ -->
          <div id="trainingStatus">å‡†å¤‡å¼€å§‹è®­ç»ƒ...</div>  <!-- è®­ç»ƒçŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
          <div id="trainingProgress"></div>  <!-- è®­ç»ƒè¿›åº¦æ˜¾ç¤ºåŒºåŸŸ -->
          <div id="modelMetrics"></div>  <!-- æ¨¡å‹æŒ‡æ ‡æ˜¾ç¤ºåŒºåŸŸ -->
        </div>

        <!-- å®æ—¶é¢„æµ‹æ§åˆ¶å¡ç‰‡ -->
        <div class="card">
          <h3>âš¡ å®æ—¶é¢„æµ‹æ§åˆ¶</h3>  <!-- å¡ç‰‡æ ‡é¢˜ -->
          <!-- ä¸‰ä¸ªåŠŸèƒ½æŒ‰é’® -->
          <button onclick="startTraining()">å¼€å§‹è®­ç»ƒæ¨¡å‹</button>  <!-- è®­ç»ƒæ¨¡å‹æŒ‰é’® -->
          <button onclick="generatePredictions()">ç”Ÿæˆç½‘æ ¼é¢„æµ‹</button>  <!-- ç”Ÿæˆé¢„æµ‹æŒ‰é’® -->
          <button onclick="resetModel()">é‡ç½®æ¨¡å‹</button>  <!-- é‡ç½®æ¨¡å‹æŒ‰é’® -->
        </div>
      </div>

      <!-- é«˜é£é™©ç½‘æ ¼é¢„è­¦å¡ç‰‡ -->
      <div class="card">
        <h3>ğŸ” é«˜é£é™©ç½‘æ ¼é¢„è­¦</h3>  <!-- å¡ç‰‡æ ‡é¢˜ -->
        <div id="predictions"></div>  <!-- é¢„æµ‹ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
      </div>

      <!-- ç‰¹å¾é‡è¦æ€§åˆ†æå¡ç‰‡ -->
      <div class="card">
        <h3>ğŸ“ˆ ç‰¹å¾é‡è¦æ€§åˆ†æ</h3>  <!-- å¡ç‰‡æ ‡é¢˜ -->
        <div id="featureImportance" class="feature-importance"></div>  <!-- ç‰¹å¾é‡è¦æ€§æ˜¾ç¤ºåŒºåŸŸ -->
      </div>
    </div>

    <!-- JavaScriptä»£ç éƒ¨åˆ† -->
    <script>
      // æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå™¨ç±»ï¼Œç”¨äºåˆ›å»ºè®­ç»ƒæ•°æ®å’Œé¢„æµ‹æ•°æ®
      class PowerGridDataGenerator {
        // æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ç‰¹å¾åˆ—è¡¨
        constructor() {
          // å®šä¹‰æ¨¡å‹ä½¿ç”¨çš„10ä¸ªç‰¹å¾
          this.features = [
            'population_density', // äººå£å¯†åº¦
            'load_rate', // è´Ÿè½½ç‡
            'historical_faults', // å†å²æ•…éšœæ•°
            'special_group_density', // ç‰¹æ®Šç¾¤ä½“å¯†åº¦
            'equipment_age', // è®¾å¤‡è€åŒ–ç¨‹åº¦
            'external_risk', // å¤–éƒ¨é£é™©
            'holiday_flag', // æ˜¯å¦èŠ‚å‡æ—¥
            'economic_level', // ç»æµæ°´å¹³
            'historical_complaints', // å†å²æŠ•è¯‰æ•°
            'temperature', // æ¸©åº¦
          ]
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿè®­ç»ƒæ•°æ®çš„æ–¹æ³•
        // å‚æ•°samplesï¼šè¦ç”Ÿæˆçš„æ ·æœ¬æ•°é‡ï¼Œé»˜è®¤ä¸º10000ä¸ª
        generateTrainingData(samples = 10000) {
          // åˆå§‹åŒ–ç‰¹å¾å’Œæ ‡ç­¾æ•°ç»„
          const features = []
          const labels = []

          // å¾ªç¯ç”ŸæˆæŒ‡å®šæ•°é‡çš„æ ·æœ¬
          for (let i = 0; i < samples; i++) {
            // è°ƒç”¨generateSampleæ–¹æ³•ç”Ÿæˆå•ä¸ªæ ·æœ¬
            const sample = this.generateSample()
            // å°†æ ·æœ¬çš„ç‰¹å¾å’Œæ ‡ç­¾åˆ†åˆ«æ·»åŠ åˆ°å¯¹åº”æ•°ç»„
            features.push(sample.features)
            labels.push(sample.label)
          }

          // è¿”å›è½¬æ¢ä¸ºTensorFlowå¼ é‡æ ¼å¼çš„æ•°æ®
          return {
            features: tf.tensor2d(features), // 2ç»´å¼ é‡ï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªæ ·æœ¬çš„ç‰¹å¾
            labels: tf.tensor1d(labels),     // 1ç»´å¼ é‡ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæ ·æœ¬çš„æ ‡ç­¾
          }
        }

        // ç”Ÿæˆå•ä¸ªæ ·æœ¬çš„æ–¹æ³•
        generateSample() {
          // ç”Ÿæˆç¬¦åˆä¸šåŠ¡é€»è¾‘çš„å„ç§ç‰¹å¾å€¼
          const populationDensity = Math.random() // äººå£å¯†åº¦ 0-1ä¹‹é—´çš„éšæœºæ•°
          const loadRate = Math.random() // è´Ÿè½½ç‡ 0-1ä¹‹é—´çš„éšæœºæ•°
          const historicalFaults = Math.floor(Math.random() * 10) // å†å²æ•…éšœæ•° 0-9çš„æ•´æ•°
          const specialGroupDensity = Math.random() // ç‰¹æ®Šç¾¤ä½“å¯†åº¦ 0-1ä¹‹é—´çš„éšæœºæ•°
          const equipmentAge = Math.random() // è®¾å¤‡è€åŒ–ç¨‹åº¦ 0-1ä¹‹é—´çš„éšæœºæ•°
          const externalRisk = Math.random() // å¤–éƒ¨é£é™© 0-1ä¹‹é—´çš„éšæœºæ•°
          const holidayFlag = Math.random() > 0.7 ? 1 : 0 // 30%æ¦‚ç‡æ˜¯èŠ‚å‡æ—¥ï¼ˆå€¼ä¸º1ï¼‰
          const economicLevel = Math.random() // ç»æµæ°´å¹³ 0-1ä¹‹é—´çš„éšæœºæ•°
          const historicalComplaints = Math.floor(Math.random() * 5) // å†å²æŠ•è¯‰æ•° 0-4çš„æ•´æ•°
          const temperature = 20 + Math.random() * 30 // æ¸©åº¦ 20-50Â°Cä¹‹é—´çš„éšæœºæ•°

          // å°†æ‰€æœ‰ç‰¹å¾å€¼ç»„åˆæˆæ•°ç»„ï¼Œå¹¶å¯¹éƒ¨åˆ†ç‰¹å¾è¿›è¡Œå½’ä¸€åŒ–å¤„ç†
          const features = [
            populationDensity, // å·²ç»æ˜¯0-1èŒƒå›´ï¼Œæ— éœ€å½’ä¸€åŒ–
            loadRate,          // å·²ç»æ˜¯0-1èŒƒå›´ï¼Œæ— éœ€å½’ä¸€åŒ–
            historicalFaults / 10, // å½’ä¸€åŒ–åˆ°0-1èŒƒå›´
            specialGroupDensity,  // å·²ç»æ˜¯0-1èŒƒå›´ï¼Œæ— éœ€å½’ä¸€åŒ–
            equipmentAge,         // å·²ç»æ˜¯0-1èŒƒå›´ï¼Œæ— éœ€å½’ä¸€åŒ–
            externalRisk,         // å·²ç»æ˜¯0-1èŒƒå›´ï¼Œæ— éœ€å½’ä¸€åŒ–
            holidayFlag,          // äºŒå…ƒå€¼ï¼Œæ— éœ€å½’ä¸€åŒ–
            economicLevel,        // å·²ç»æ˜¯0-1èŒƒå›´ï¼Œæ— éœ€å½’ä¸€åŒ–
            historicalComplaints / 5, // å½’ä¸€åŒ–åˆ°0-1èŒƒå›´
            (temperature - 20) / 30, // å½’ä¸€åŒ–åˆ°0-1èŒƒå›´
          ]

          // åŸºäºä¸šåŠ¡è§„åˆ™ç”Ÿæˆæ ‡ç­¾ï¼ˆæ¨¡æ‹ŸçœŸå®ä¸–ç•Œä¸­çš„æŠ•è¯‰æ¦‚ç‡æ¨¡å¼ï¼‰
          let complaintProbability = 0

          // æ ¸å¿ƒé©±åŠ¨å› å­æƒé‡è¾ƒé«˜
          complaintProbability += populationDensity * 0.15  // äººå£å¯†åº¦æƒé‡15%
          complaintProbability += loadRate * 0.2             // è´Ÿè½½ç‡æƒé‡20%
          complaintProbability += (historicalFaults / 10) * 0.15  // å†å²æ•…éšœæ•°æƒé‡15%
          complaintProbability += specialGroupDensity * 0.25  // ç‰¹æ®Šç¾¤ä½“å¯†åº¦æƒé‡25%

          // èƒŒæ™¯è°ƒèŠ‚å› å­æƒé‡è¾ƒä½
          complaintProbability += equipmentAge * 0.1      // è®¾å¤‡è€åŒ–ç¨‹åº¦æƒé‡10%
          complaintProbability += externalRisk * 0.08     // å¤–éƒ¨é£é™©æƒé‡8%
          complaintProbability += holidayFlag * 0.05      // æ˜¯å¦èŠ‚å‡æ—¥æƒé‡5%
          complaintProbability += economicLevel * 0.02    // ç»æµæ°´å¹³æƒé‡2%

          // æ·»åŠ ä¸€äº›éšæœºå™ªå£°ï¼Œæ¨¡æ‹Ÿç°å®ä¸–ç•Œçš„ä¸ç¡®å®šæ€§
          complaintProbability += (Math.random() - 0.5) * 0.1

          // æ ¹æ®æ¦‚ç‡å€¼ç”ŸæˆäºŒåˆ†ç±»æ ‡ç­¾ï¼šæ¦‚ç‡å¤§äº0.5ä¸º1ï¼ˆä¼šæŠ•è¯‰ï¼‰ï¼Œå¦åˆ™ä¸º0ï¼ˆä¸ä¼šæŠ•è¯‰ï¼‰
          const label = complaintProbability > 0.5 ? 1 : 0

          // è¿”å›ç‰¹å¾æ•°ç»„å’Œå¯¹åº”çš„æ ‡ç­¾
          return { features, label }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿé¢„æµ‹æ•°æ®ï¼ˆå½“å‰ç”µç½‘ç½‘æ ¼çŠ¶æ€ï¼‰
        // å‚æ•°gridCountï¼šè¦ç”Ÿæˆçš„ç½‘æ ¼æ•°é‡ï¼Œé»˜è®¤ä¸º20ä¸ª
        generatePredictionData(gridCount = 20) {
          // åˆå§‹åŒ–ç½‘æ ¼æ•°ç»„
          const grids = []
          // å¾ªç¯ç”ŸæˆæŒ‡å®šæ•°é‡çš„ç½‘æ ¼æ•°æ®
          for (let i = 0; i < gridCount; i++) {
            // ç”Ÿæˆæ ·æœ¬æ•°æ®
            const sample = this.generateSample()
            // æ·»åŠ ç½‘æ ¼IDå’Œå…¶ä»–ä¿¡æ¯
            grids.push({
              id: `GRID_${(i + 1).toString().padStart(3, '0')}`, // æ ¼å¼åŒ–ç½‘æ ¼IDï¼Œå¦‚GRID_001
              features: sample.features,  // ç½‘æ ¼ç‰¹å¾
              riskLevel: 'pending',       // åˆå§‹é£é™©ç­‰çº§ä¸ºç­‰å¾…é¢„æµ‹
            })
          }
          // è¿”å›ç½‘æ ¼æ•°æ®æ•°ç»„
          return grids
        }
      }

      // æŠ•è¯‰é¢„æµ‹æ¨¡å‹ç±»ï¼Œå®šä¹‰ç¥ç»ç½‘ç»œæ¨¡å‹å’Œç›¸å…³æ“ä½œ
      class ComplaintPredictionModel {
        // æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ¨¡å‹ç›¸å…³å˜é‡
        constructor() {
          this.model = null           // æ¨¡å‹å®ä¾‹ï¼Œåˆå§‹ä¸ºnull
          this.isTrained = false      // æ¨¡å‹æ˜¯å¦å·²è®­ç»ƒæ ‡å¿—
          this.trainingHistory = null // è®­ç»ƒå†å²è®°å½•
        }

        // åˆ›å»ºç¥ç»ç½‘ç»œæ¨¡å‹çš„æ–¹æ³•
        createModel() {
          // åˆ›å»ºé¡ºåºæ¨¡å‹ï¼ˆå±‚æŒ‰é¡ºåºå †å ï¼‰
          const model = tf.sequential({
            layers: [
              // è¾“å…¥å±‚ï¼Œå¯¹åº”10ä¸ªç‰¹å¾
              tf.layers.dense({
                inputShape: [10],       // è¾“å…¥å½¢çŠ¶ï¼š10ä¸ªç‰¹å¾
                units: 64,              // ç¥ç»å…ƒæ•°é‡ï¼š64ä¸ª
                activation: 'relu',     // æ¿€æ´»å‡½æ•°ï¼šReLU
                kernelInitializer: 'heNormal', // æƒé‡åˆå§‹åŒ–æ–¹æ³•ï¼šHeæ­£æ€åˆ†å¸ƒ
              }),
              // Dropoutå±‚ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œéšæœºä¸¢å¼ƒ30%çš„ç¥ç»å…ƒ
              tf.layers.dropout({ rate: 0.3 }),

              // éšè—å±‚
              tf.layers.dense({
                units: 32,              // ç¥ç»å…ƒæ•°é‡ï¼š32ä¸ª
                activation: 'relu',     // æ¿€æ´»å‡½æ•°ï¼šReLU
              }),
              // ç¬¬äºŒä¸ªDropoutå±‚ï¼Œéšæœºä¸¢å¼ƒ20%çš„ç¥ç»å…ƒ
              tf.layers.dropout({ rate: 0.2 }),

              // è¾“å‡ºå±‚ - äºŒåˆ†ç±»é—®é¢˜
              tf.layers.dense({
                units: 1,               // è¾“å‡ºå•å…ƒæ•°ï¼š1ä¸ªï¼ˆæ¦‚ç‡å€¼ï¼‰
                activation: 'sigmoid',  // æ¿€æ´»å‡½æ•°ï¼šSigmoidï¼ˆè¾“å‡º0-1ä¹‹é—´çš„æ¦‚ç‡ï¼‰
              }),
            ],
          })

          // ç¼–è¯‘æ¨¡å‹ï¼Œè®¾ç½®ä¼˜åŒ–å™¨ã€æŸå¤±å‡½æ•°å’Œè¯„ä¼°æŒ‡æ ‡
          model.compile({
            optimizer: tf.train.adam(0.001), // Adamä¼˜åŒ–å™¨ï¼Œå­¦ä¹ ç‡0.001
            loss: 'binaryCrossentropy',     // äºŒåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°
            metrics: ['accuracy'],          // è¯„ä¼°æŒ‡æ ‡ï¼šå‡†ç¡®ç‡
          })

          // ä¿å­˜æ¨¡å‹å®ä¾‹å¹¶è¿”å›
          this.model = model
          return model
        }

        // è®­ç»ƒæ¨¡å‹çš„æ–¹æ³•
        // å‚æ•°featuresï¼šç‰¹å¾å¼ é‡
        // å‚æ•°labelsï¼šæ ‡ç­¾å¼ é‡
        // å‚æ•°epochsï¼šè®­ç»ƒè½®æ•°ï¼Œé»˜è®¤ä¸º100è½®
        async train(features, labels, epochs = 100) {
          // å¦‚æœæ¨¡å‹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°æ¨¡å‹
          if (!this.model) {
            this.createModel()
          }

          // æ‹†åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼ˆ80%è®­ç»ƒï¼Œ20%éªŒè¯ï¼‰
          const splitIndex = Math.floor(features.shape[0] * 0.8)
          const trainFeatures = features.slice(0, splitIndex)     // è®­ç»ƒç‰¹å¾
          const trainLabels = labels.slice(0, splitIndex)         // è®­ç»ƒæ ‡ç­¾
          const valFeatures = features.slice(splitIndex)          // éªŒè¯ç‰¹å¾
          const valLabels = labels.slice(splitIndex)              // éªŒè¯æ ‡ç­¾

          // è®­ç»ƒæ¨¡å‹å¹¶è·å–è®­ç»ƒå†å²
          this.trainingHistory = await this.model.fit(
            trainFeatures,  // è®­ç»ƒç‰¹å¾
            trainLabels,    // è®­ç»ƒæ ‡ç­¾
            {
              epochs: epochs,                    // è®­ç»ƒè½®æ•°
              validationData: [valFeatures, valLabels], // éªŒè¯æ•°æ®
              batchSize: 32,                     // æ‰¹æ¬¡å¤§å°ï¼š32
              callbacks: {                       // å›è°ƒå‡½æ•°
                onEpochEnd: async (epoch, logs) => {  // æ¯è½®ç»“æŸæ—¶æ‰§è¡Œ
                  // æ›´æ–°è®­ç»ƒçŠ¶æ€æ˜¾ç¤º
                  document.getElementById(
                    'trainingStatus'
                  ).innerHTML = `è®­ç»ƒä¸­... ç¬¬ ${epoch + 1}/${epochs} è½®`
                  // æ›´æ–°è®­ç»ƒè¿›åº¦æ˜¾ç¤ºï¼Œå…¼å®¹ä¸åŒç‰ˆæœ¬çš„TensorFlow.js
                  document.getElementById('trainingProgress').innerHTML =
                    `è®­ç»ƒå‡†ç¡®ç‡: ${logs.accuracy ? logs.accuracy.toFixed(4) : (logs.acc ? logs.acc.toFixed(4) : 'N/A')} | ` +
                    `éªŒè¯å‡†ç¡®ç‡: ${
                      logs.val_accuracy ? logs.val_accuracy.toFixed(4) : (logs.val_acc ? logs.val_acc.toFixed(4) : 'N/A')
                    }`

                  // å¼ºåˆ¶UIæ›´æ–°ï¼Œç¡®ä¿è¿›åº¦å®æ—¶æ˜¾ç¤º
                  await tf.nextFrame()
                },
              },
            }
          )

          // è®¾ç½®è®­ç»ƒå®Œæˆæ ‡å¿—
          this.isTrained = true
          // è¿”å›è®­ç»ƒå†å²
          return this.trainingHistory
        }

        // é¢„æµ‹ç½‘æ ¼é£é™©çš„æ–¹æ³•
        // å‚æ•°gridsï¼šç½‘æ ¼æ•°æ®æ•°ç»„
        async predict(grids) {
          // æ£€æŸ¥æ¨¡å‹æ˜¯å¦å·²è®­ç»ƒ
          if (!this.isTrained) {
            throw new Error('æ¨¡å‹å°šæœªè®­ç»ƒï¼Œè¯·å…ˆè®­ç»ƒæ¨¡å‹')
          }

          // æå–æ‰€æœ‰ç½‘æ ¼çš„ç‰¹å¾æ•°æ®
          const featuresArray = grids.map((grid) => grid.features)
          // å°†ç‰¹å¾æ•°æ®è½¬æ¢ä¸º2ç»´å¼ é‡
          const featuresTensor = tf.tensor2d(featuresArray)

          // ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹
          const predictions = await this.model.predict(featuresTensor)
          // è·å–é¢„æµ‹ç»“æœæ•°æ®
          const predictionData = await predictions.data()

          // æ¸…ç†å¼ é‡ï¼Œé‡Šæ”¾å†…å­˜
          featuresTensor.dispose()
          predictions.dispose()

          // ä¸ºæ¯ä¸ªç½‘æ ¼æ·»åŠ é¢„æµ‹ç»“æœ
          return grids.map((grid, index) => {
            // è·å–å½“å‰ç½‘æ ¼çš„é£é™©åˆ†æ•°
            const riskScore = predictionData[index]
            let riskLevel, riskClass

            // æ ¹æ®é£é™©åˆ†æ•°ç¡®å®šé£é™©ç­‰çº§å’Œå¯¹åº”çš„CSSç±»
            if (riskScore < 0.3) {
              riskLevel = 'ä½é£é™©'
              riskClass = 'risk-low'
            } else if (riskScore < 0.7) {
              riskLevel = 'ä¸­é£é™©'
              riskClass = 'risk-medium'
            } else {
              riskLevel = 'é«˜é£é™©'
              riskClass = 'risk-high'
            }

            // è¿”å›å¢å¼ºåçš„ç½‘æ ¼æ•°æ®ï¼ŒåŒ…å«é£é™©é¢„æµ‹ä¿¡æ¯
            return {
              ...grid,                // ä¿ç•™åŸæœ‰å±æ€§
              riskScore: riskScore,   // æ·»åŠ é£é™©åˆ†æ•°
              riskLevel: riskLevel,   // æ·»åŠ é£é™©ç­‰çº§æ–‡æœ¬
              riskClass: riskClass,   // æ·»åŠ é£é™©ç­‰çº§CSSç±»
            }
          })
        }

        // è®¡ç®—ç‰¹å¾é‡è¦æ€§çš„æ–¹æ³•ï¼ˆæ¨¡æ‹Ÿå®ç°ï¼‰
        getFeatureImportance() {
          // å®šä¹‰ç‰¹å¾çš„ä¸­æ–‡åç§°
          const featureNames = [
            'äººå£å¯†åº¦',
            'è´Ÿè½½ç‡',
            'å†å²æ•…éšœæ•°',
            'ç‰¹æ®Šç¾¤ä½“å¯†åº¦',
            'è®¾å¤‡è€åŒ–ç¨‹åº¦',
            'å¤–éƒ¨é£é™©',
            'æ˜¯å¦èŠ‚å‡æ—¥',
            'ç»æµæ°´å¹³',
            'å†å²æŠ•è¯‰æ•°',
            'æ¸©åº¦',
          ]

          // æ¨¡æ‹Ÿç‰¹å¾é‡è¦æ€§ï¼ˆåœ¨å®é™…é¡¹ç›®ä¸­éœ€è¦é€šè¿‡æ’åˆ—é‡è¦æ€§ç­‰æ–¹æ³•è®¡ç®—ï¼‰
          return featureNames
            .map((name, index) => ({
              name: name,
              importance: 0.3 + Math.random() * 0.7, // ç”Ÿæˆ0.3-1ä¹‹é—´çš„éšæœºé‡è¦æ€§åˆ†æ•°
            }))
            .sort((a, b) => b.importance - a.importance) // æŒ‰é‡è¦æ€§é™åºæ’åº
        }
      }

      // åˆ›å»ºå…¨å±€å˜é‡å®ä¾‹
      let dataGenerator = new PowerGridDataGenerator()       // æ•°æ®ç”Ÿæˆå™¨å®ä¾‹
      let predictionModel = new ComplaintPredictionModel()   // é¢„æµ‹æ¨¡å‹å®ä¾‹
      let currentGrids = []                                  // å½“å‰ç½‘æ ¼æ•°æ®

      // å¼€å§‹è®­ç»ƒæ¨¡å‹çš„å‡½æ•°
      async function startTraining() {
        try {
          // æ›´æ–°UIæ˜¾ç¤ºè®­ç»ƒçŠ¶æ€
          document.getElementById('trainingStatus').innerHTML =
            'ç”Ÿæˆè®­ç»ƒæ•°æ®ä¸­...'

          // ç”Ÿæˆ5000ä¸ªè®­ç»ƒæ ·æœ¬
          const trainingData = dataGenerator.generateTrainingData(5000)
          // æ›´æ–°UIæ˜¾ç¤ºæ•°æ®ç”Ÿæˆå®Œæˆ
          document.getElementById('trainingStatus').innerHTML =
            'æ•°æ®ç”Ÿæˆå®Œæˆï¼Œå¼€å§‹è®­ç»ƒæ¨¡å‹...'

          // è®­ç»ƒæ¨¡å‹ï¼Œä½¿ç”¨50è½®
          await predictionModel.train(
            trainingData.features,
            trainingData.labels,
            50
          )

          // æ›´æ–°UIæ˜¾ç¤ºè®­ç»ƒå®Œæˆ
          document.getElementById('trainingStatus').innerHTML =
            '<span style="color: green;">âœ… æ¨¡å‹è®­ç»ƒå®Œæˆï¼</span>'
          document.getElementById('modelMetrics').innerHTML =
            'æ¨¡å‹å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹é¢„æµ‹ç½‘æ ¼é£é™©'

          // æ¸…ç†å†…å­˜ï¼Œé‡Šæ”¾è®­ç»ƒæ•°æ®å¼ é‡
          trainingData.features.dispose()
          trainingData.labels.dispose()
        } catch (error) {
          // æ•è·å¹¶æ˜¾ç¤ºè®­ç»ƒè¿‡ç¨‹ä¸­çš„é”™è¯¯
          console.error('è®­ç»ƒå¤±è´¥:', error)
          document.getElementById(
            'trainingStatus'
          ).innerHTML = `<span style="color: red;">è®­ç»ƒå¤±è´¥: ${error.message}</span>`
        }
      }

      // ç”Ÿæˆé¢„æµ‹ç»“æœçš„å‡½æ•°
      async function generatePredictions() {
        // æ£€æŸ¥æ¨¡å‹æ˜¯å¦å·²è®­ç»ƒ
        if (!predictionModel.isTrained) {
          alert('è¯·å…ˆè®­ç»ƒæ¨¡å‹ï¼') // æ˜¾ç¤ºæç¤ºä¿¡æ¯
          return                  // ç»ˆæ­¢å‡½æ•°æ‰§è¡Œ
        }

        try {
          // æ›´æ–°UIæ˜¾ç¤ºé¢„æµ‹ä¸­çŠ¶æ€
          document.getElementById('predictions').innerHTML = 'é¢„æµ‹ä¸­...'

          // ç”Ÿæˆ15ä¸ªç½‘æ ¼çš„æ¨¡æ‹Ÿæ•°æ®
          currentGrids = dataGenerator.generatePredictionData(15)

          // ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹
          const predictions = await predictionModel.predict(currentGrids)

          // æ˜¾ç¤ºé¢„æµ‹ç»“æœ
          displayPredictions(predictions)

          // æ˜¾ç¤ºç‰¹å¾é‡è¦æ€§åˆ†æ
          displayFeatureImportance()
        } catch (error) {
          // æ•è·å¹¶æ˜¾ç¤ºé¢„æµ‹è¿‡ç¨‹ä¸­çš„é”™è¯¯
          console.error('é¢„æµ‹å¤±è´¥:', error)
          document.getElementById(
            'predictions'
          ).innerHTML = `<span style="color: red;">é¢„æµ‹å¤±è´¥: ${error.message}</span>`
        }
      }

      // æ˜¾ç¤ºé¢„æµ‹ç»“æœçš„å‡½æ•°
      function displayPredictions(predictions) {
        let html = '' // åˆå§‹åŒ–HTMLå­—ç¬¦ä¸²

        // éå†æ‰€æœ‰é¢„æµ‹ç»“æœ
        predictions.forEach((grid) => {
          // æ ¹æ®é£é™©åˆ†æ•°ç¡®å®šå¡ç‰‡æ ·å¼ç±»
          const cardClass =
            grid.riskScore > 0.7
              ? 'high-risk'
              : grid.riskScore > 0.4
              ? 'medium-risk'
              : ''

          // æ„å»ºå¡ç‰‡HTMLå†…å®¹
          html += `
                <div class="card ${cardClass}">
                    <h4>${grid.id} 
                        <span class="risk-indicator ${grid.riskClass}">
                            ${grid.riskLevel} (${(grid.riskScore * 100).toFixed(1)}%)
                        </span>
                    </h4>
                    <p>ç‰¹å¾: äººå£å¯†åº¦ ${(grid.features[0] * 100).toFixed(1)}%, 
                        è´Ÿè½½ç‡ ${(grid.features[1] * 100).toFixed(1)}%, 
                        ç‰¹æ®Šç¾¤ä½“ ${(grid.features[3] * 100).toFixed(1)}%</p>
                </div>
                `
        })

        // å°†ç”Ÿæˆçš„HTMLè®¾ç½®åˆ°é¢„æµ‹ç»“æœæ˜¾ç¤ºåŒºåŸŸ
        document.getElementById('predictions').innerHTML = html
      }

      // æ˜¾ç¤ºç‰¹å¾é‡è¦æ€§çš„å‡½æ•°
      function displayFeatureImportance() {
        // è·å–ç‰¹å¾é‡è¦æ€§æ•°æ®
        const importance = predictionModel.getFeatureImportance()
        let html = '' // åˆå§‹åŒ–HTMLå­—ç¬¦ä¸²

        // éå†æ‰€æœ‰ç‰¹å¾é‡è¦æ€§æ•°æ®
        importance.forEach((feature) => {
          // è®¡ç®—è¿›åº¦æ¡å®½åº¦ï¼ˆç™¾åˆ†æ¯”ï¼‰
          const width = feature.importance * 100 + '%'
          // æ„å»ºç‰¹å¾é‡è¦æ€§æ¡çš„HTMLå†…å®¹
          html += `
                <div class="feature-bar">
                    <div class="feature-name">${feature.name}</div>
                    <div class="feature-value">
                        <div class="feature-fill" style="width: ${width}"></div>
                    </div>
                    <div style="width: 60px; text-align: right;">
                        ${(feature.importance * 100).toFixed(1)}%
                    </div>
                </div>
                `
        })

        // å°†ç”Ÿæˆçš„HTMLè®¾ç½®åˆ°ç‰¹å¾é‡è¦æ€§æ˜¾ç¤ºåŒºåŸŸ
        document.getElementById('featureImportance').innerHTML = html
      }

      // é‡ç½®æ¨¡å‹çš„å‡½æ•°
      function resetModel() {
        // åˆ›å»ºæ–°çš„æ¨¡å‹å®ä¾‹
        predictionModel = new ComplaintPredictionModel()
        // é‡ç½®UIæ˜¾ç¤º
        document.getElementById('trainingStatus').innerHTML =
          'æ¨¡å‹å·²é‡ç½®ï¼Œå‡†å¤‡å¼€å§‹è®­ç»ƒ...'
        document.getElementById('trainingProgress').innerHTML = ''
        document.getElementById('modelMetrics').innerHTML = ''
        document.getElementById('predictions').innerHTML = ''
        document.getElementById('featureImportance').innerHTML = ''
      }

      // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œçš„åˆå§‹åŒ–å‡½æ•°
      document.addEventListener('DOMContentLoaded', function () {
        // è¾“å‡ºåˆå§‹åŒ–ä¿¡æ¯åˆ°æ§åˆ¶å°
        console.log('æ•æ„Ÿäººç¾¤åŠ¨æ€ä¿ç”µé¢„æµ‹ç³»ç»Ÿå·²åˆå§‹åŒ–')
        console.log('ç‚¹å‡»"å¼€å§‹è®­ç»ƒæ¨¡å‹"æ¥è®­ç»ƒç¥ç»ç½‘ç»œ')
      })
    </script>
  </body>
</html>