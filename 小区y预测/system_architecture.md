# 小区y预测系统架构设计文档

## 1. 系统架构概览

### 1.1 整体架构

本系统采用前后端分离的架构设计，具体如下：

- **前端**：基于Vue3构建的单页应用(SPA)
- **后端**：基于NestJS构建的RESTful API服务
- **数据存储**：
  - 原始CSV数据文件
  - 模型文件存储
  - 预测结果存储
- **机器学习框架**：TensorFlow.js用于后端模型训练和预测

### 1.2 技术栈详细说明

#### 前端技术栈：
- **框架**：Vue 3 + Composition API
- **构建工具**：Vite
- **UI组件库**：Element Plus
- **数据可视化**：ECharts
- **HTTP客户端**：Axios
- **状态管理**：Pinia

#### 后端技术栈：
- **框架**：NestJS
- **数据处理**：Pandas.js, csv-parser
- **机器学习**：TensorFlow.js, ML.js
- **文件处理**：Multer
- **数据验证**：class-validator

## 2. 模块划分

### 2.1 前端模块

1. **数据管理模块**
   - 文件上传组件
   - 数据预览组件
   - 数据列选择组件

2. **模型训练模块**
   - 训练参数配置组件
   - 训练过程可视化组件
   - 模型性能展示组件

3. **预测分析模块**
   - 预测参数配置组件
   - 预测结果可视化组件
   - 历史数据对比组件

4. **用户界面模块**
   - 导航组件
   - 状态提示组件
   - 设置组件

### 2.2 后端模块

1. **数据处理模块**
   - 文件上传处理
   - 数据解析与清洗
   - 特征工程

2. **模型管理模块**
   - 模型创建与训练
   - 模型保存与加载
   - 模型评估

3. **预测服务模块**
   - 单步预测
   - 多步预测
   - 预测结果处理

4. **API接口模块**
   - 数据管理接口
   - 模型操作接口
   - 预测请求接口

## 3. 数据流向图

```
┌───────────────┐      ┌───────────────┐      ┌───────────────┐
│   前端界面    │      │   后端服务    │      │   数据与模型  │
└───────┬───────┘      └───────┬───────┘      └───────┬───────┘
        │                      │                      │
        │ 1. 上传CSV文件       │                      │
        ├─────────────────────>│                      │
        │                      │ 2. 解析数据          │
        │                      ├─────────────────────>│
        │                      │                      │
        │ 3. 返回数据预览      │                      │
        │<─────────────────────┤                      │
        │                      │                      │
        │ 4. 配置训练参数      │                      │
        ├─────────────────────>│                      │
        │                      │ 5. 训练模型          │
        │                      ├─────────────────────>│
        │                      │                      │
        │ 6. 返回训练状态/结果 │                      │
        │<─────────────────────┤                      │
        │                      │                      │
        │ 7. 发送预测请求      │                      │
        ├─────────────────────>│                      │
        │                      │ 8. 执行预测          │
        │                      ├─────────────────────>│
        │                      │                      │
        │ 9. 返回预测结果      │                      │
        │<─────────────────────┤                      │
        │                      │                      │
        │10. 可视化展示结果    │                      │
        │<─────────────────────┘                      │
┌───────┴───────┐                                     │
│   用户交互    │                                     │
└───────────────┘                                     │
        ^                                             │
        │                                             │
        └─────────────────────────────────────────────┘
```

## 4. 数据预处理方案

### 4.1 缺失值处理
- 数值型数据：使用均值/中位数填充
- 类别型数据：使用众数填充
- 时间序列数据：使用前向填充或插值方法

### 4.2 异常值检测
- 使用Z-score方法检测数值型特征的异常值
- 使用箱线图方法(IQR)检测极值
- 对异常值进行修正或移除

### 4.3 特征标准化/归一化
- 数值型特征：使用MinMaxScaler进行归一化
- 类别型特征：使用One-Hot编码转换
- 时间特征：提取月份、季度等周期性特征

### 4.4 时间特征提取策略
- 从"年月"字段提取年份和月份
- 计算时间差特征
- 创建时间窗口特征（滑动窗口统计）
- 添加季节性指标

## 5. 机器学习算法选型分析

### 5.1 候选算法对比

| 算法 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| LSTM (长短期记忆网络) | - 能捕获长期依赖关系<br>- 适合复杂的时间模式<br>- 可处理非线性关系 | - 训练时间长<br>- 参数调优复杂<br>- 对计算资源要求高 | 复杂的时间序列预测，数据有明显的时序模式 |
| Prophet | - 处理趋势和季节性能力强<br>- 对缺失值和异常值鲁棒<br>- 参数少，易于使用 | - 对于高度非线性模式表现一般<br>- 灵活性较低<br>- 不适合多变量预测 | 具有明显季节性和趋势的数据，业务预测 |
| XGBoost | - 训练速度快<br>- 处理多种特征类型<br>- 可解释性较好 | - 需要手动提取时间特征<br>- 难以捕获长期依赖<br>- 可能需要复杂的特征工程 | 混合特征类型，需要快速训练和部署 |
| ARIMA | - 理论基础扎实<br>- 适合单变量时间序列<br>- 实现简单 | - 难以处理多变量<br>- 假设线性关系<br>- 对非平稳序列需要差分 | 具有自相关性的平稳时间序列 |

### 5.2 推荐算法

基于我们的数据特点（多变量时间序列，有多种类型的特征），推荐使用以下算法组合：

1. **主要模型**：LSTM - 捕获长期依赖关系和非线性模式
2. **备选模型**：XGBoost - 快速训练和良好的可解释性
3. **集成策略**：模型融合，结合多个模型的预测结果

## 6. 系统部署架构

### 6.1 开发环境
- 前端：Node.js + npm/yarn/pnpm
- 后端：Node.js + NestJS CLI
- 版本控制：Git

### 6.2 生产环境
- 前端部署：Nginx静态文件服务器
- 后端部署：PM2进程管理
- 数据存储：文件系统或对象存储
- 容器化：可选Docker + Docker Compose

## 7. 系统安全与性能考虑

### 7.1 安全措施
- 文件上传验证和过滤
- API访问权限控制
- 输入数据验证
- 防止资源滥用（请求限流）

### 7.2 性能优化
- 数据处理分批进行
- 模型训练异步执行
- 前端组件懒加载
- 结果缓存机制

## 8. 扩展性设计

### 8.1 功能扩展
- 支持更多类型的文件格式
- 提供更多机器学习算法选项
- 添加自定义特征工程功能
- 支持模型导出和共享

### 8.2 架构扩展
- 微服务化拆分
- 引入消息队列处理异步任务
- 添加数据持久化存储
- 支持分布式训练